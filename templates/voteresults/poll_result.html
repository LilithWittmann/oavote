{% extends 'base.html' %}
{% load staticfiles %}


{% block header_title %}
	Ergebnisse {{ poll.title }}
{% endblock %}

{% block header_add %}
	<!--[if lte IE 8]>
		<script src="{% static 'js/excanvas.min.js' %}"></script>
	<![endif]-->

	<script src="{% static 'js/jquery.min.js' %}"></script>
	<script src="{% static 'js/jquery.flot.min.js' %}"></script>
	<script src="{% static 'js/jquery.flot.pie.min.js' %}"></script>

	<script>
		function labelFormatter() {
			return 'ohai';
		}

		$(document).ready(function() {

			$('.plot-pie').each(function(i, plot) {

				var data = [ {label: "Dafür", data: $(plot).data('yes'), color: '#EDC240'}, {label: "Dagegen", data: $(plot).data('no'), color: '#CB4B4B'}, {label: "Enthaltung", data: $(plot).data('abst'), color: '#AFD8F8'}];

				var options = {
					series: {
						pie: {
							show: true,

						}
  					},

  					legend: {
  						show: true,
						labelFormatter: function(label, series) {
							console.log(series.data);
							return label + ': ' + Math.round(series.percent) + '%';
						}
  					}
  				};

				$.plot(plot, data, options); 

			})
		})
	</script>

	<style>
	.plot-pie {
		width: 350px;
		height: 150px;
		margin-bottom: 40px;
	}

	.vote-details {
		font-size: 0.85em;
		display: none;
	}

	a {
		cursor: pointer;
	}
	</style>
{% endblock %}

{% block content %}
	<h1>Ergebnisse {{ poll.title }}</h1>

	<p>
		Stimmberechtigte Personen: {{ users.count }}<br />
		Abgegebene Stimmen: {{ votes.count }}
	</p>

	<hr />

	{% for question in questions %}
		<h2>{{ question.title }}</h2>
		<div class='plot plot-pie' id='plot-pie-{{ question.id }}' data-yes='{{ question.get_result.0 }}' data-no='{{ question.get_result.1 }}' data-abst='{{ question.get_result.2 }}'></div>

		<p>Dieser Antrag wurde mit {{ question.get_result.0 }} Ja-Stimmen, {{ question.get_result.1 }} Nein-Stimmen und {{ question.get_result.2 }} aktiven Enthaltungen
			{% if question.get_result.0 > question.get_result.1 %}
				<strong>angenommen</strong>.
			{% endif %}
			{% if question.get_result.1 >= question.get_result.0 %}
				<strong>abgelehnt</strong>.
			{% endif %}
		</p>

		<a onclick='$("#vote-details-{{ question.id }}").toggle()'>» Details</a>
		<p class='vote-details' id='vote-details-{{ question.id }}'>
			{% for vote in question.vote_set.all %}
				#{{ vote.voting_user.member_id }}: {{ vote.get_choice_display }}<br />
			{% endfor %}
		</p>
	{% endfor %}
{% endblock %}
